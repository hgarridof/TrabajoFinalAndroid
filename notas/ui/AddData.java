package com.hgf.android.notas.ui;import android.Manifest;import android.annotation.TargetApi;import android.app.Activity;import android.content.ContentResolver;import android.content.ContentValues;import android.content.Context;import android.content.Intent;import android.content.pm.PackageManager;import android.location.Location;import android.location.LocationListener;import android.location.LocationManager;import android.os.Build;import android.os.Bundle;import android.support.v7.app.AppCompatActivity;import android.text.format.DateFormat;import android.util.Log;import android.view.Menu;import android.view.MenuItem;import android.view.View;import android.widget.Button;import android.widget.EditText;import android.widget.TextView;import android.widget.Toast;import com.google.android.gms.maps.GoogleMap;import com.google.android.gms.maps.MapFragment;import com.hgf.android.notas.Maps.GPSTracker;import com.hgf.android.notas.Maps.MapsActivity;import com.hgf.android.notas.db.ConnectionDB;import com.hgf.android.notas.R;import com.hgf.android.notas.db.ContentProviderBD;import java.util.Date;import static android.location.LocationManager.GPS_PROVIDER;/** * Created by hector on 3/6/16. * Interfaz grafica para a√±adir nuevas notas y modificar las erxistentes */public class AddData extends AppCompatActivity {    EditText mTitle, mContent;    Button mSave;    String mTitulo, mNota;    int mId;    ConnectionDB db;    GoogleMap mMap;    MapFragment mMapFragment;    double lat, lon;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.insert_data);        int id = 0;        Intent intent = getIntent();        id = intent.getIntExtra("NotaId", 0);        final String titulo = intent.getStringExtra("NotaTitulo");        final String cuerpo = intent.getStringExtra("NotaCuerpo");        //LocationManager lm = (LocationManager) getSystemService(Context.LOCATION_SERVICE);        mSave = (Button) findViewById(R.id.saveButton);        mTitle = (EditText) findViewById(R.id.titleEditText);        mContent = (EditText) findViewById(R.id.bodyEditText);        mId = id;        if (mId != 0) {            mTitle.setText(titulo);            mContent.setText(cuerpo);        }        GPSTracker mGPS = new GPSTracker(this);            if(mGPS.canGetLocation() ){            mGPS.getLocation();            lat = mGPS.getLatitude();            lon = mGPS.getLongitude();        }else{            Log.e("ERROR: ", "Unable to connect");        }        Toast.makeText(this, lat + ", " + lon, Toast.LENGTH_LONG).show();        mSave.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                if (mId != 0) {                    modifyDatos();                } else {                    if (lat == 0.0 && lon == 0.0) {                        lat = 40.41;                        lon = -3.7;                    }                    addDatos(lon, lat);                }            }        });    }    private void addDatos(double lon, double lat){        mTitulo = mTitle.getText().toString();        mNota = mContent.getText().toString();        String fecha = "";        fecha = fechaActual();        MapsActivity map = new MapsActivity();        /*        db = new ConnectionDB(this);        db.addNote(mTitulo, mNota, fecha);        */        ContentValues values = new ContentValues();        values.put(ContentProviderBD.Note.COL_TITLE, mTitulo);        values.put(ContentProviderBD.Note.COL_CONTENT, mNota);        values.put(ContentProviderBD.Note.COL_DATE, fecha);        values.put(ContentProviderBD.Note.COL_LATITUDE, lat);        values.put(ContentProviderBD.Note.COL_LONGITUDE, lon);        ContentResolver cr = getContentResolver();        cr.insert(ContentProviderBD.CONTENT_URI, values);        //db.close();        Intent intent = new Intent(AddData.this, MainActivity.class);        startActivity(intent);        finish();    }    private void modifyDatos(){        mTitulo = mTitle.getText().toString();        mNota = mContent.getText().toString();        String fecha = "";        fecha = fechaActual();        ContentValues values = new ContentValues();        values.put(ContentProviderBD.Note.COL_TITLE, mTitulo);        values.put(ContentProviderBD.Note.COL_CONTENT, mNota);        values.put(ContentProviderBD.Note.COL_DATE, fecha);        ContentResolver cr = getContentResolver();        cr.update(ContentProviderBD.CONTENT_URI, values, ContentProviderBD.Note.COL_ID + " = " + mId, null);        Intent intent = new Intent(AddData.this, MainActivity.class);        startActivity(intent);        finish();    }    private String fechaActual(){        String fecha = "";        Date d = new Date();        CharSequence s = "";        s  = DateFormat.format("MMMM d, yyyy ", d.getTime());        fecha = s.toString();        return fecha;    }    @Override    public boolean onCreateOptionsMenu(Menu menu) {        // Inflate the menu; this adds items to the action bar if it is present.        getMenuInflater().inflate(R.menu.menu_nota, menu);        return true;    }    @Override    public boolean onOptionsItemSelected(MenuItem item) {        // Handle action bar item clicks here. The action bar will        // automatically handle clicks on the Home/Up button, so long        // as you specify a parent activity in AndroidManifest.xml.        int id = item.getItemId();        //noinspection SimplifiableIfStatement        if (id == R.id.action_Main) {            Intent intent = new Intent(AddData.this, MainActivity.class);            startActivity(intent);            finish();        }        if (id == R.id.action_Maps) {            Intent intent = new Intent(AddData.this, MapsActivity.class);            startActivity(intent);            finish();        }        if (id == R.id.Salir){            finish();            Intent intent = new Intent(Intent.ACTION_MAIN);            startActivity(intent);        }        return super.onOptionsItemSelected(item);    }}